{% extends "layout.html" %}
{% block title %}Fertilizer Recommendation - Harvest Helper{% endblock %}
{% block content %}
<div class="form-wrapper">
    <div class="form-container shadow-lg">
        <h2 class="text-center mb-4">Fertilizer Recommendation</h2>
        <p class="text-center text-muted mb-4">Provide the following details to receive a fertilizer recommendation.</p>
        <form id="fertilizerForm">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="Temperature" class="form-label">Temperature (Â°C)</label>
                    <input type="number" step="0.01" class="form-control" id="Temperature" name="Temperature" placeholder="e.g., 26" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Humidity" class="form-label">Humidity (%)</label>
                    <input type="number" step="0.01" class="form-control" id="Humidity" name="Humidity" placeholder="e.g., 52" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Moisture" class="form-label">Moisture</label>
                    <input type="number" class="form-control" id="Moisture" name="Moisture" placeholder="e.g., 38" required>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="Soil_Type" class="form-label">Soil Type</label>
                <select class="form-select" id="Soil_Type" name="Soil_Type" required>
                    <option value="">Select Soil Type</option>
                    {% for soil in soil_types %}
                        <option value="{{ soil }}">{{ soil }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="Crop_Type" class="form-label">Crop Type</label>
                <select class="form-select" id="Crop_Type" name="Crop_Type" required>
                    <option value="">Select Crop Type</option>
                    {% for crop in crop_types %}
                        <option value="{{ crop }}">{{ crop }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="Nitrogen" class="form-label">Nitrogen (N)</label>
                    <input type="number" class="form-control" id="Nitrogen" name="Nitrogen" placeholder="e.g., 37" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Potassium" class="form-label">Potassium (K)</label>
                    <input type="number" class="form-control" id="Potassium" name="Potassium" placeholder="e.g., 0" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Phosphorous" class="form-label">Phosphorous (P)</label>
                    <input type="number" class="form-control" id="Phosphorous" name="Phosphorous" placeholder="e.g., 0" required>
                </div>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg">Get Recommendation</button>
            </div>
        </form>
        <div id="fertilizerResult" class="mt-4 text-center">
            <!-- Animation and result will be displayed here -->
        </div>
        <div class="text-center mt-3">
            <a href="/" class="btn btn-secondary">Back to Home</a>
        </div>
    </div>
</div>

<script>
    document.getElementById('fertilizerForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const resultDiv = document.getElementById('fertilizerResult');
        resultDiv.innerHTML = `<div class="spinner-container"><div class="spinner-border text-info" role="status"><span class="visually-hidden">Analyzing...</span></div><p class="mt-2">Finding the best fertilizer...</p></div>`;

        const formData = new FormData(this);

        fetch('/predict_fertilizer', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.prediction) {
                resultDiv.innerHTML = `<div class="alert alert-success fade-in"><h4>Recommended Fertilizer:</h4><p class="display-6 fw-bold">${data.prediction}</p></div>`;
            } else {
                 resultDiv.innerHTML = `<div class="alert alert-danger fade-in"><h4>Error:</h4><p>${data.error || 'An unknown error occurred.'}</p></div>`;
            }
        })
        .catch(error => {
            resultDiv.innerHTML = `<div class="alert alert-danger fade-in"><h4>An error occurred:</h4><p>${error}</p></div>`;
        });
    });
</script>
{% endblock %}