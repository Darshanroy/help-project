{% extends "layout.html" %}
{% block title %}Crop Recommendation{% endblock %}
{% block content %}
<div class="form-wrapper">
    <div class="form-container shadow-lg">
        <h2 class="text-center mb-4">Crop Recommendation</h2>
        <p class="text-center text-muted mb-4">Enter the following details to get a crop recommendation.</p>
        <form id="cropForm">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="N" class="form-label">Nitrogen (N)</label>
                    <input type="number" class="form-control" id="N" name="N" placeholder="e.g., 90" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="P" class="form-label">Phosphorus (P)</label>
                    <input type="number" class="form-control" id="P" name="P" placeholder="e.g., 42" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="K" class="form-label">Potassium (K)</label>
                    <input type="number" class="form-control" id="K" name="K" placeholder="e.g., 43" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="temperature" class="form-label">Temperature (Â°C)</label>
                    <input type="number" step="0.01" class="form-control" id="temperature" name="temperature" placeholder="e.g., 20.87" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="humidity" class="form-label">Humidity (%)</label>
                    <input type="number" step="0.01" class="form-control" id="humidity" name="humidity" placeholder="e.g., 82.00" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="ph" class="form-label">pH Level</label>
                    <input type="number" step="0.01" class="form-control" id="ph" name="ph" placeholder="e.g., 6.50" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="rainfall" class="form-label">Rainfall (mm)</label>
                    <input type="number" step="0.01" class="form-control" id="rainfall" name="rainfall" placeholder="e.g., 202.93" required>
                </div>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg">Get Recommendation</button>
            </div>
        </form>
        <div id="result" class="mt-4 text-center">
            <!-- Animation and result will be displayed here -->
        </div>
        <div class="text-center mt-3">
            <a href="/" class="btn btn-secondary">Back to Home</a>
        </div>
    </div>
</div>

<script>
    document.getElementById('cropForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const resultDiv = document.getElementById('result');
        
        // --- Animation Start ---
        resultDiv.innerHTML = `
            <div class="spinner-container">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Analyzing your data...</p>
            </div>
        `;

        const formData = new FormData(this);

        fetch('/predict', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // --- Animation End ---
            if (data.prediction) {
                // Fade-in animation for the result
                resultDiv.innerHTML = `
                    <div class="alert alert-success fade-in">
                        <h4>Recommended Crop:</h4>
                        <p class="display-6 fw-bold">${data.prediction}</p>
                    </div>
                `;
            } else {
                 resultDiv.innerHTML = `
                    <div class="alert alert-danger fade-in">
                        <h4>Error:</h4>
                        <p>${data.error}</p>
                    </div>
                `;
            }
        })
        .catch(error => {
            resultDiv.innerHTML = `
                <div class="alert alert-danger fade-in">
                    <h4>An error occurred:</h4>
                    <p>${error}</p>
                </div>
            `;
        });
    });
</script>
{% endblock %}